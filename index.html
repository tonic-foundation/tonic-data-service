<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@tonic-foundation/data-client - v0.0.5</title><meta name="description" content="Documentation for @tonic-foundation/data-client - v0.0.5"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@tonic-foundation/data-client - v0.0.5</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@tonic-foundation/data-client - v0.0.5 </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#tonic-data-api" id="tonic-data-api" style="color: inherit; text-decoration: none;">
  <h2>Tonic Data API</h2>
</a>
<p>Tonic indexed market data API.</p>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<pre><code><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-0">add</span><span class="hl-1"> @</span><span class="hl-0">tonic</span><span class="hl-1">-</span><span class="hl-0">foundation</span><span class="hl-1">/</span><span class="hl-0">data</span><span class="hl-1">-</span><span class="hl-0">client</span>
</code></pre>

<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
  <h2>Examples</h2>
</a>
<pre><code class="language-typescript"><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">indexer</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-4">TonicIndexer</span><span class="hl-1">(</span><span class="hl-5">&#39;https://data-api.mainnet.tonic.foundation&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// get supported markets</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">markets</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-0">indexer</span><span class="hl-1">.</span><span class="hl-4">markets</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// stream recent trades</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">&#39;getting trade stream for market&#39;</span><span class="hl-1">, </span><span class="hl-0">markets</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">].</span><span class="hl-0">symbol</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> [</span><span class="hl-3">stream</span><span class="hl-1">, </span><span class="hl-3">stop</span><span class="hl-1">] = </span><span class="hl-0">indexer</span><span class="hl-1">.</span><span class="hl-4">recentTradeStream</span><span class="hl-1">(</span><span class="hl-0">markets</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">].</span><span class="hl-0">id</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">setTimeout</span><span class="hl-1">(</span><span class="hl-0">stop</span><span class="hl-1">, </span><span class="hl-8">10_000</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">for</span><span class="hl-1"> </span><span class="hl-7">await</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">trade</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-0">stream</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-0">trade</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">&#39;stopped&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">})();</span>
</code></pre>

<a href="#running-the-data-api" id="running-the-data-api" style="color: inherit; text-decoration: none;">
  <h2>Running the data API</h2>
</a>
<p>Run an instance of the <a href="https://github.com/tonic-foundation/tonic-indexer">Tonic indexer</a>.</p>
<p>Set the following environment variables.</p>
<pre><code><span class="hl-1"># </span><span class="hl-0">Point</span><span class="hl-1"> </span><span class="hl-0">to</span><span class="hl-1"> </span><span class="hl-0">the</span><span class="hl-1"> </span><span class="hl-0">same</span><span class="hl-1"> </span><span class="hl-3">DB</span><span class="hl-1"> </span><span class="hl-7">as</span><span class="hl-1"> </span><span class="hl-9">the</span><span class="hl-1"> </span><span class="hl-9">indexer</span><span class="hl-1">. </span><span class="hl-9">A</span><span class="hl-1"> </span><span class="hl-9">read</span><span class="hl-1">-</span><span class="hl-0">only</span><span class="hl-1"> </span><span class="hl-0">user</span><span class="hl-1"> </span><span class="hl-0">is</span><span class="hl-1"> </span><span class="hl-3">OK</span><span class="hl-1">.</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">POSTGRES_CONNECTION</span><span class="hl-1">=</span><span class="hl-10">postgresql</span><span class="hl-1">:</span><span class="hl-6">//...</span>
</code></pre>
<details>
<summary>
Have a self-signed Postgres cert?
</summary>

<p>Base64-encode the cert and set it in the evironment as</p>
<pre><code><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">POSTGRES_CA_CERT</span><span class="hl-1">=</span><span class="hl-0">Ls0tLS1</span><span class="hl-1">...</span>
</code></pre>
</details>

<p>Start the API.</p>
<pre><code><span class="hl-1"># </span><span class="hl-0">build</span><span class="hl-1"> </span><span class="hl-0">the</span><span class="hl-1"> </span><span class="hl-0">server</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-10">build</span><span class="hl-1">:</span><span class="hl-0">all</span><br/><br/><span class="hl-1"># </span><span class="hl-0">run</span><span class="hl-1"> </span><span class="hl-0">it</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-0">api</span><span class="hl-1"> </span><span class="hl-0">start</span><br/><span class="hl-1">{</span><span class="hl-5">&quot;level&quot;</span><span class="hl-1">:</span><span class="hl-8">30</span><span class="hl-1">,</span><span class="hl-5">&quot;time&quot;</span><span class="hl-1">:</span><span class="hl-8">1659042446457</span><span class="hl-1">,</span><span class="hl-5">&quot;pid&quot;</span><span class="hl-1">:</span><span class="hl-8">82965</span><span class="hl-1">,</span><span class="hl-5">&quot;hostname&quot;</span><span class="hl-1">:</span><span class="hl-5">&quot;workstation.local&quot;</span><span class="hl-1">,</span><span class="hl-5">&quot;msg&quot;</span><span class="hl-1">:</span><span class="hl-5">&quot;initialized sentry (env=testnet,samplerate=0.01)&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">ðŸš€  </span><span class="hl-0">Fastify</span><span class="hl-1"> </span><span class="hl-0">server</span><span class="hl-1"> </span><span class="hl-0">running</span><span class="hl-1"> </span><span class="hl-0">on</span><span class="hl-1"> </span><span class="hl-0">port</span><span class="hl-1"> </span><span class="hl-8">3006</span><br/><span class="hl-1">{</span><span class="hl-5">&quot;level&quot;</span><span class="hl-1">:</span><span class="hl-8">30</span><span class="hl-1">,</span><span class="hl-5">&quot;time&quot;</span><span class="hl-1">:</span><span class="hl-8">1659042446589</span><span class="hl-1">,</span><span class="hl-5">&quot;pid&quot;</span><span class="hl-1">:</span><span class="hl-8">82965</span><span class="hl-1">,</span><span class="hl-5">&quot;hostname&quot;</span><span class="hl-1">:</span><span class="hl-5">&quot;workstation.local&quot;</span><span class="hl-1">,</span><span class="hl-5">&quot;msg&quot;</span><span class="hl-1">:</span><span class="hl-5">&quot;Server listening at http://127.0.0.1:3006&quot;</span><span class="hl-1">}</span>
</code></pre>

<a href="#listing-a-market" id="listing-a-market" style="color: inherit; text-decoration: none;">
  <h2>Listing a market</h2>
</a>
<p>Set postgres connection details as shown above (write user required)</p>
<pre><code class="language-bash"><span class="hl-6"># Add tokens used by the market. Tokens only need to be added once.</span><br/><span class="hl-1">NEAR_ENV=mainnet yarn api add-token --token_id usn </span><span class="hl-6"># token ID is contract ID</span><br/><span class="hl-1">NEAR_ENV=mainnet yarn api add-token --token_id near </span><span class="hl-6"># &quot;near&quot; allowed for native near</span><br/><br/><span class="hl-6"># Add market. Symbol must be lowercase.</span><br/><span class="hl-1">NEAR_ENV=mainnet yarn api add-market --market_id AAGR... --symbol foo/usdc</span><br/><br/><span class="hl-6"># Make it visible. Markets are invisible by default.</span><br/><span class="hl-1">yarn api set-visibility --symbol foo/usdc --visibility </span><span class="hl-4">true</span>
</code></pre>

<a href="#running-the-leaderboard" id="running-the-leaderboard" style="color: inherit; text-decoration: none;">
  <h2>Running the leaderboard</h2>
</a>
<p>Leaderboard required manual setup for now. Read the migrations.</p>

<a href="#running-a-rewards-program" id="running-a-rewards-program" style="color: inherit; text-decoration: none;">
  <h2>Running a rewards program</h2>
</a>
<ul>
<li>Update <code>scripts/rewards/set-params.sql</code> if necessary and run it.</li>
<li>Run <code>scripts/rewards/init.sql</code> for your first batch of rewards---you must run this at least once.</li>
<li>Run <code>scripts/rewards/update.sql</code> for each day of rewards&larr;untested, you may need to test this.</li>
</ul>

<a href="#known-issues" id="known-issues" style="color: inherit; text-decoration: none;">
  <h2>Known issues</h2>
</a>
<ul>
<li>Migrations are all in the indexer repo. We&#39;ll combine the two repos in the future.</li>
</ul>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/TonicIndexer.html" class="tsd-kind-icon">Tonic<wbr/>Indexer</a></li><li class="tsd-kind-interface"><a href="interfaces/Fill.html" class="tsd-kind-icon">Fill</a></li><li class="tsd-kind-interface"><a href="interfaces/MarketInfo.html" class="tsd-kind-icon">Market<wbr/>Info</a></li><li class="tsd-kind-interface"><a href="interfaces/MarketStats.html" class="tsd-kind-icon">Market<wbr/>Stats</a></li><li class="tsd-kind-interface"><a href="interfaces/OrderStatus.html" class="tsd-kind-icon">Order<wbr/>Status</a></li><li class="tsd-kind-interface"><a href="interfaces/RecentTrade.html" class="tsd-kind-icon">Recent<wbr/>Trade</a></li><li class="tsd-kind-interface"><a href="interfaces/Trade.html" class="tsd-kind-icon">Trade</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>